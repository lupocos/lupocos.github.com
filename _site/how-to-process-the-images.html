<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Homer, the DIY Book Scanner - How to process the images</title>
	<link rel="stylesheet" href="/css/styles.css" type="text/css" charset="utf-8">
</head>
<body>
<div id="header">
	<div id="site_title"><h1>Homer, the DIY Book Scanner</h1></div>
</div>
<div id="content">
	<h1 id="how-to-process-the-images">How to process the images</h1>

<p>Once you have shot all your photos, download them inside a new folder on your PC or Mac. Now launch the application called &ldquo;Homer&rdquo;, which Windows users should find on their Desktop (it is in fact a shortcut), while Mac users find on the Dock. From here you have to select the input folder containing the images to be renamed and rotated. </p>

<p>Homer for Mac displays a dialog window from where you can browse your hard drive and find the wanted folders, whereas the Windows version immediately starts within the Command Prompt, and asks you to enter the &ldquo;path&rdquo; to the input folder (e.g., <code>"C:\Documents and Settings\cosimolupo\Desktop\input-folder"</code>). But there&rsquo;s no need to be scared of the black window. Both Windows and Mac users can &ldquo;drag and drop&rdquo; the folder onto the icon of the Homer script, which will then regard it as input for processing. And Windows users don&rsquo;t need to digit the full path, but can also drag and drop the directory containing the images on the Command Prompt window itself. The OS will then take care of inserting the right path (enclosed in quotes if containing spaces).</p>

<p>After you have selected the input folder, you will be prompted to choose among four alternative options. The first two allows to rename and rotate the images depending on whether you started scanning from the right- or from the left-hand pages; the third option is for renaming the images without rotating them (a quicker option for those who prefer using Scan Tailor to rotate the images after that); finally, the fourth option is for running the text recognition software (Tesseract OCR) and for converting the files into a single, searchable PDF. Between the first three options for reordering, and the fourth one for converting to PDF, stands a middle step, which is perhaps the most important one and which cannot be included in the Homer script, not only because it is too complex but also because there is already a full-blown application for that, which happens to be free too: the middle step consist in &ldquo;post-processing&rdquo; the images, and the application is called <a href="http://scantailor.sourceforge.net/" title="About | Scan Tailor">Scan Tailor</a>, available on all operating systems.</p>

<h2 id="step-1-renaming-and-rotating">Step 1: Renaming and rotating</h2>

<p>When you press &ldquo;1&rdquo; or &ldquo;2&rdquo; on Homer&rsquo;s startup menu, all the images inside the input folder are automatically renamed and rotated according to your preferences. The original files are left untouched, while the renamed files are saved in a new folder inside the input one. The script renames and rotates about 2 images per second on average, depending on the speed of your computer. </p>

<p>In order to rotate the images, Homer uses a program called <a href="http://en.wikipedia.org/wiki/Jpegtran" title="libjpeg (from Wikipedia)">jpegtran</a>, a command-line utility included in the libjpeg library, which has the advantage of performing &ldquo;lossless&rdquo; transformations: that is, the rotation is done &ldquo;without decompressing and recompressing the data, and so causing a reduction of image quality due to generation loss&rdquo; [^4].</p>

<h2 id="step-2-post-processing">Step 2: Post-processing</h2>

<p>Scan Tailor is a truly powerful tool for enhancing the quality of scanned images, making them more readable, more similar to print than mere digital photos of a book. Its developer, Joseph Artsimovich, defines it as</p>

<blockquote>
  <p>An interactive post-processing tool for scanned pages. It performs operations such as page splitting, deskewing, adding/removing borders, and others. You give it raw scans, and you get pages ready to be printed or assembled into a PDF[^5]. </p>
</blockquote>

<p>Here we will not try to explain in detail how to use such a complex program. For that, there is already the <a href="http://sourceforge.net/apps/mediawiki/scantailor/index.php?title=Main_Page" title="Main Page | Scan Tailor Wiki">Scan Tailor Wiki</a> page, which includes a User Guide as well as <a href="http://vimeo.com/12524529" title="Scan Tailor Tutorial | Joseph Artsimovich on Vimeo">video tutorials</a>. Here we will only give a few brief instructions in order to obtain acceptable results without too many troubles. Actually, the best place to start is the <a href="http://sourceforge.net/apps/mediawiki/scantailor/index.php?title=Quick_Start_Guide" title="Quick Start Guide | Scan Tailor Wiki">&ldquo;Quick Start Guide&rdquo;</a> on the same official wiki. What follows is basically a paraphrase from the latter.</p>

<ol>
  <li>Lauch ScanTailor and select &lsquo;New project&rsquo; to begin with a new set of images.</li>
  <li>Browse to select the directory that contains the images you wish to process.</li>
  <li>ScanTailor will create by default an &lsquo;out&rsquo; directory for processed images placed inside the input directory. Leave it like that.</li>
  <li>At the next stage it’s necessary to set the &ldquo;dots-per-inch&rdquo; (<a href="http://en.wikipedia.org/wiki/Dots_per_inch" title="Dots per inches (from Wikipedia)">DPI</a>) level. Click on &lsquo;All pages&rsquo;, and use the &lsquo;Custom&rsquo; drop-down menu to select &lsquo;300 x 300&rsquo; [^6]. </li>
  <li>We may skip the &lsquo;Fix orientation&rsquo; step if we have already rotated the images using jpegtran.</li>
  <li>Click to ‘Split pages’, and Scan Tailor will try to autodetect the page layout. In our case, with a single-camera book scanner taking one page at a time, the correct option is the central one  in the Page Layout section (i.e., single page with something to crop at the edges). Then click on the <code>&gt;</code> arrow to have ScanTailor batch process the remainder of the images according to the selected Page Layout option. You should always inspect individual pages in the thumbnails to the right of the main page, in order to prevent Scan Tailor from cutting away some portion of text or image. Clicking on a thumbnail will load that page to the main area and allow for manual adjustment of various parameters.</li>
  <li>After having splitted the pages, you need to &lsquo;deskew&rsquo; or straighten up the inclination of the pages such that the text is correctly aligned. Once again use the <code>&gt;</code> arrow to batch process as needed and use the thumbnails to quickly check each page.</li>
  <li>Click on &lsquo;Select content&rsquo; and batch process (<code>&gt;</code> right arrow), while always keeping an eye on the thumbnails. If something is not selected you should adjust it manually, by selecting the thumbnail and resizing the content box in the main page as needed (by dragging its edges). If no content is selected a content box may be manually entered by selecting that image and right-click in the main window, &lsquo;Add content box&rsquo;. Likewise one may remove a content box from a page by right-click and &lsquo;Delete&rsquo;.</li>
  <li>Then move to the &lsquo;Margins&rsquo; section and adjust the various parameters according to your requirements. ScanTailor defaults work well for most cases. Again, click the <code>&gt;</code> arrow and then go on to the final step.</li>
  <li>In the &lsquo;Output&rsquo; section, you can select the type of image output desired. Black and white will produce a clean output image for simple text and line drawings. If some text appears to be &lsquo;missing&rsquo; try increasing the line thickness to see if it appears. Once you choose your settings, these may be applied to all pages and run through the batch process (<code>&gt;</code> arrow). Alternatively for images with photographs or graphics you may select &lsquo;mixed&rsquo; or even &lsquo;colour/grayscale&rsquo;. Our recommendation is to stick to black &amp; white whenever is possible, so that the file will load faster and have a smaller size; and to select either 300 or 400 DPI as &lsquo;Output resolution&rsquo;, that is, about the same as the input one (600 is maybe too much for simple text). Anyway, it&rsquo;s always better to check the thumbnails &ndash; particularly at this final stage &ndash;, to make sure that the required content is not excluded by mistake.</li>
  <li>The &lsquo;output&rsquo; batch process is usually the one that take the longest to complete, depending on the overall performaces of your computer. Set up Scan Tailor to &lsquo;beep when finished&rsquo; and go have a coffee or tea. The output files will be saved as TIFF in the default &lsquo;out&rsquo; directory inside the &lsquo;renamed&rsquo; directory.</li>
</ol>

<h2 id="step-3-ocr-and-conversion-to-pdf">Step 3: OCR and conversion to PDF</h2>

<p>The third and last stage of the overall procedure is in turn comprised of two smaller steps: first, we need to apply to our pictures the optical character recognition (OCR) engine, so that the text contained in them will lend itself to be copied &amp; pasted in our word processor, or highlighted and searched in our PDF viewer; secondly, we want to combine the scanned images and the OCR-ed text thus produced into a single, portable document that will retain the appearance of the images but will include an invisible layer of text underneath.</p>

<p>In order to recognize the text from the images, Homer employs another free software, currently sponsored by Google, called <a href="http://code.google.com/p/tesseract-ocr/" title="Tesseract OCR">Tesseract</a>. This OCR engine was originally developed as proprietary software at Hewlett-Packard, and has been released as open source a few years ago. It is compatible with all three major operating systems and, as of version 3.00, it supports as many as 35 languages. Did I say it&rsquo;s <em>free</em>?</p>

<p>Now, the output of Tesseract are HTML files text encoded in the <a href="http://en.wikipedia.org/wiki/HOCR" title="hOCR (from Wikipedia)">hOCR</a> format, but that&rsquo;s not yet a PDF. For binding together the TIFF images and the HTML files Homer uses <a href="http://rubygems.org/gems/pdfbeads" title="PDFbeads | RubyGems.org">PDFbeads</a>, a small Ruby utility developed by Alexey Kryukov. Besides creating a searchable PDF, the program also compresses any b/w TIFFs using the <a href="http://en.wikipedia.org/wiki/JBIG2" title="JBIG2 (from Wikipedia)">JBIG2</a> encoder, a very efficient image compression standard: for example, a book of 384 pages is contained in a single PDF file of 11.8 MB (including front and back covers in colour, and several illustrations in &lsquo;mixed&rsquo; mode).</p>

<p>Both Tesseract and PDFbeads are command-line utilities, so they are well suited to be run through a bash script. As we have already mentioned, the option number &ldquo;4&rdquo; in the Homer script is meant to run Tesseract OCR on the &ldquo;out&rdquo; folder &ndash; the one containing the TIFF images processed by Scan Tailor &ndash;, and eventually merge those images and their OCR-ed text into a searchable PDF.</p>

<p>This is done in the same way as for the renaming-rotating task. That is, by draggin the &ldquo;out&rdquo; folder on Homer&rsquo;s icon (or on the Command Prompt window), and then selecting the option &ldquo;4&rdquo;. The script will prompt you to specify two variables before starting the process:</p>

<ol>
  <li>
    <p>the <strong>language</strong> in which the scanned pages are written, identified by its three-characters label. To view the complete list of Tesseract supported languages inside Homer window, leave the field blank and press <code>ENTER</code> (you can also read the <a href="http://code.google.com/p/tesseract-ocr/downloads/list" title="Download List | Tesseract OCR">list</a> online). For each languange there is a corresponing three-characters label in Tesseract&rsquo;s vocabulary: English is &ldquo;eng&rdquo;, Italian is &ldquo;ita&rdquo;, Portuguese is &ldquo;por&rdquo;, etc. We didn&rsquo;t modify the labels, but used the default ones from Tesseract (don&rsquo;t blame us if Spanish is &ldquo;spa&rdquo; and not &ldquo;esp&rdquo;, while French is &ldquo;fra&rdquo; and German is &ldquo;deu&rdquo;…). </p>
  </li>
  <li>
    <p>the <strong>name of the final PDF</strong>: you don&rsquo;t need to append the &ldquo;.pdf&rdquo; extension, it is added automatically; the filename may contain spaces; the file will be saved on the Desktop by default.</p>
  </li>
</ol>

<p>Text recognition may take 1 or 2 seconds per page on average, even more if colour/greyscale. You can watch the ongoing process on the Terminal or Command Prompt window &ndash; but it&rsquo;s a boring sequence of &ldquo;Processed image 0234.tif, etc.&rdquo;. When the process is finally completed, the window will come to foreground and you will be able to &ldquo;press any key&rdquo; to show the results!</p>

<p>Note that the quality of the text recognition may vary according to various factors like the quality the original shots, their resolution, the sort of typeface which is used in the printed book, and so on. If you are not satisfied with Tesseract and are willing to spend a few hundred pounds on it, we would recommend to try Adobe Acrobat (either Standard or Professional), not only for its quite good OCR engine but, above all, for its state-of-the-art <a href="http://acrobatusers.com/tutorials/better-pdf-ocr-clearscan-smaller-looks-better" title="Clear Scan: How it works">ClearScan</a> technology which turns pixelated images of text characters into smoothed &ldquo;vector&rdquo; curves. In other words, for each set of scanned images it creates a custom font matching the visual appearance of the printed text characters and embeds it into the PDF. Not just it looks better, but also produces smaller files that loads/scrolls faster on a PDF viewer than common &ldquo;raster&rdquo; graphics.</p>


</div>
<div id="footer">
	<a href="http://jekyllrb.com/">jekyll</a> rules!
</div>
</body>
</html>